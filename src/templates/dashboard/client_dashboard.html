{% extends 'base.html' %}


{% block content %}
<div class="container px-6 mx-auto">
<!-- Start Edit modal -->
    <!--  المودال نفسه -->
    {% for project in projects %}
    <div id="edit-modal-{{project.id}}" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-lg w-11/12 md:w-1/3 p-6 relative">
        
        <!-- زر إغلاق -->
        <button onclick="document.getElementById('edit-modal-{{project.id}}').classList.add('hidden')" class="absolute top-2 left-2 text-gray-500 hover:text-gray-700 text-xl">
            &times;
        </button>
    
        <!-- محتوى المودال -->
        <h2 class="text-xl font-bold mb-4"> {{project.title}} - تعديل طلب المشروع</h2>
        <form action="{% url 'client_edit_project' project.pk %}" method="POST">
            {% csrf_token %}
            <form method="POST" class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-md space-y-5">
                {% csrf_token %}
                <!-- عنوان المشروع -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">عنوان المشروع</label>
                  <input type="text" name="title" placeholder="أدخل عنوان المشروع"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                    value="{{ project.title }}"/>
                </div>
              
                <!-- وصف المشروع -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">وصف المشروع</label>
                  <textarea name="description" rows="4" placeholder="أدخل وصفًا للمشروع"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">{{ project.description }}</textarea>
                </div>
              
                <!-- نوع المشروع -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">نوع المشروع</label>
                  <select name="type"
                    class="mt-1 block w-full px-10 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="web" {% if project.type == 'web' %}selected{% endif %}>تطبيق ويب</option>
                    <option value="mobile" {% if project.type == 'mobile' %}selected{% endif %}>تطبيق موبايل</option>
                    <option value="desktop" {% if project.type == 'desktop' %}selected{% endif %}>تطبيق ديسكتوب</option>
                    <option value="other" {% if project.type == 'other' %}selected{% endif %}>أخرى</option>
                  </select>
                </div>
              
                <!-- Checkbox: باوربوينت -->
                <div class="flex items-center">
                  <input type="checkbox" name="include_ppt" id="include_ppt" class="mx-2 my-2" {% if project.ppt_presentation %} checked{% endif %}>
                  <label for="include_ppt" class="text-sm text-gray-700">تضمين استعراض باوربوينت</label>
                </div>
              
                <!-- Checkbox: بطاقة تقنية -->
                <div class="flex items-center">
                  <input type="checkbox" name="include_datasheet" id="include_datasheet" class="mx-2 my-2" {% if project.tech_card %} checked{% endif %}>
                  <label for="include_datasheet" class="text-sm text-gray-700">تضمين بطاقة تقنية</label>
                </div>
              
                <!-- زر حفظ -->
                <div class="text-end">
                  <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">حفظ</button>
                </div>
              </form>
              
        </form>
       
        </div>
    </div>
    {% endfor %}
    <!-- End edit modal -->

    <div class="flex flex-col justify-center items-center mt-10">
        <h1 class="text-2xl text-slate-700">مرحبا بك في لوحة التحكم {{ request.user.username }}</h1>
        <h1 class="text-xl text-slate-800 py-2 px-4 mt-4 rounded-full shadow-lg">لديك {{ projects.count }} مشروع</h1>
        {% if request.user.chat_id %}
            <span class="text-gray-500 text-sm my-4">حسابك مربوط ب telegram</span>
        {% else %}
        <a href="{% url 'link_telegram' %}" class="py-2 px-4 bg-blue-700 text-white my-4">Telegram</a>
        {% endif %}
        <!-- Filter form -->
        <form action="" class="flex flex-wrap items-center justify-center gap-4 mt-6">
            {% csrf_token %}
            <div>
                {{ project_filter.form.title }}
            </div>
            <div>
                {{ project_filter.form.state }}
            </div>
            <div>
                {{ project_filter.form.created_at }}
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">بحث</button>
        </form>
    </div>
    <div class="flex flex-row justify-center items-center mt-10">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200 border border-slate-300">
                <thead class="bg-slate-100">
                    <tr>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700">عنوان المشروع</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700">تاريخ البدء</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700">العرض التقديمي</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700">البطاقة التقنية</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700">تاريخ التسليم</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700"> الحالة</th>
                        <th scope="col" class="px-4 py-2 text-center text-sm font-semibold text-gray-700"> الإجرائات</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200">
                    {% for project in projects %}
                    <tr>
                        <td class="px-4 py-2 text-right text-sm text-slate-600">{{ project.title }}</td>
                        <td class="px-4 py-2 text-right text-sm text-slate-600">{{ project.created_at }}</td>
                        <td class="px-4 py-2 text-right text-sm text-slate-600">{% if project.ppt_presentation %} متوفر {% else %} غير متوفر {% endif %}</td>
                        <td class="px-4 py-2 text-right text-sm text-slate-600">{% if project.tech_card %} متوفر {% else %} غير متوفر {% endif %}</td>
                        <td class="px-4 py-2 text-right text-sm text-slate-600">{% if project.delivery_date %} {{ project.delivery_date }} {% else %} غير محدد {% endif %}</td>
                        <td class=
                        "px-1 py-1 text-center text-sm 
                        {% if project.state == 'inprogress' %}
                             text-blue-500 font-bold
                        {% elif project.state == 'completed' %}
                             text-green-500 font-bold
                        {% elif project.state == 'pending' %}
                             text-slate-500 font-bold
                        {% else %}
                            text-slate-600
                        {% endif %}">
                        {{ project.state }}
                    </td>

                    <!-- Actions -->
                    <td class="px-4 py-4 center text-sm">
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                            <!-- زر التعديل -->
                            <button onclick="document.getElementById('edit-modal-{{project.id}}').classList.remove('hidden')" 
                                    class="flex items-center justify-center bg-green-600 hover:bg-green-500 text-white px-3 py-2 rounded-full transition duration-300 md:mx-2">
                                <i class="ri-edit-line mr-2"></i> تعديل
                            </button>
                            
                            <!-- زر الحذف -->
                            <a href="{% url 'client_delete_project' project.id %}" 
                               class="flex items-center justify-center bg-red-700 hover:bg-red-500 text-white px-3 py-2 rounded-full transition duration-300">
                                <i class="ri-delete-bin-line mr-2"></i> حذف
                            </a>
                        </div>
                    </td>
                        
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-slate-500">لا توجد مشاريع لعرضها</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}